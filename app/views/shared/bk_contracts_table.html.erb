<table id="contracts_list" border="1" border-color="black" cellspacing="0" cellpadding="2">

  <tr>
    <th>開始月</th><th>期間１</th><th>金額１</th><th>期間２</th><th>金額２</th><th>契約日</th><th>更・新</th><th>担当者</th>
  </tr>

<% @leaf.contracts.each do |c| %>
  <% unless c.start_month.blank? %>
    <% c.seals.each_with_index do |s, i| %>
      <% term1 = c.term1 %>
      <% term2 = c.term2 %>
    <tr>
      <td>
        <%= s.month.strftime('%m').to_i %><br/>
        <%= c.contract_date.strftime('%m/%d') %><br/>
        <%= c.staff_nickname %><br/>
        <% if (i == term1 - 1) %>
          <%= c.money1 %>
        <% elsif term2 > 0 && (i == term1 + term2 - 1) %>
          <%= c.money2 %>
        <% else %>
          <br/>
        <% end %>
      </td>
    </tr> 
    <tr> 
      <td>
        <% if s.sealed_flag then %>
          <%= s.sealed_date.strftime('%m/%d') %>貼済<br/>
          <%= s.staff_nickname %>
        <% elsif i == 0 || c.seals[i-1].sealed_flag then %>
          <%= form_for([@leaf,c,s]) do |f| %>
            <%= f.hidden_field :sealed_flag, :value => true %>
            <%= f.hidden_field :sealed_date, :value => Date.today %>
            <%= f.hidden_field :staff_nickname, :value => session[:nickname] %>
            <div class="actions">
              <%= f.submit(["#{s.month.strftime('%m月')}分貼付"]) %>
            </div>
          <% end %>
        <% else %>
          <br/><br/>
        <% end %>
      </td>
    <% end %>
  <% end %>
  </tr>
<% end %>
</table>
<br/>
<%= link_to (button_tag '契約の変更・削除', type: 'button'), leaf_contracts_path(@leaf.to_param), method: :get %>
<br/>
