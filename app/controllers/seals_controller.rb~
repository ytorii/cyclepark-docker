# Controller for seals update, delete
class SealsController < ApplicationController
  before_action :set_seal, only: [:update, :destroy]

  UPDATE_SUCCESS = 'シール貼付情報を更新しました。'.freeze
  UPDATE_SUCCESS = 'シール貼付情報を更新しました。'.freeze

  # PATCH/PUT /seals/1
  # PATCH/PUT /seals/1.json
  def update
    respond_to do |format|
      if @seal.update(seal_params)
        update_success_format(format)
      else
        @leaf = Leaf.find(params[:leaf_id])
        update_error_format(format)
      end
    end
  end

  private

  # Use callbacks to share common setup or constraints between actions.
  def set_seal
    @seal = Seal.find(params[:id])
  end

  # Never trust parameters from the scary internet,
  # only allow the white list through.
  def seal_params
    params.require(:seal).permit(
      :contract_id,
      :month,
      :sealed_flag,
      :sealed_date,
      :staff_nickname
    )
  end

  def update_success_format(format)
    format.html do
      redirect_to leaf_path(params[:leaf_id]), notice: UPDATE_SUCCESS
    end
    format.json do
      render :show, status: :ok, location: @seal
    end
  end

  def update_error_format(format)
    format.html do
      redirect_to leaf_path(params[:leaf_id]),
                  notice: @seal.errors.full_messages
    end
    format.json do
      render json: @seal.errors, status: :unprocessable_entity
    end
  end
end
